.. Gazebo仿真搭建

==============
Gazebo仿真搭建
==============

PX4提供了一种全自主飞行控制方式，offboard模式。而阿木社区具有
一套较完整，可靠的系统体系。阿木社区的学员们在购买我们的飞机回去
之后发现对我们的系统体系还不是很了解，导致操作不当还是会有很多
炸机现象，为了让学员们更加了解系统体系的种种情况，于是乎出现了
仿真系统平台下对阿木系统体系的模拟。有了这一套仿真系统，学员
可以更加理解阿木系统体系中的逻辑，熟悉这一套系统体系，结合仿真
减少实际飞行中炸机的发生。 本篇文章中，会讲解如何用模拟器来
按照我们的系统体系控制无人机飞行。本套仿真平台在
Ubuntu16.04（16.04.6）LTS，ROS-Kinetic（v1.12.14），
Firmware（1.8.2），QGroundControl-v3.3.2，交叉编译
工具链为gcc-arm-none-eabi-5_4-2016q2，mavros以及
mavlink的二进制安装下，测试通过。首先，先从搭建环境开始讲。

第一节 硬件准备
=============

笔者刚开学习的时候，用的是虚拟机vmware，但是发现用虚拟机的话，
不能进行仿真，查阅大量资料之后发现，多数由于Java原因，也有
显卡问题。我们都知道，vm里面是虚拟显卡，而且安装Ubuntu本身
自带的nouveau显卡性能本身就不行，满足不了仿真的需求。 
笔者的第一个台式电脑是学校标配的电脑，显卡记得好像是630还是
730来着，在种种环境安装配置好之后，正常的mavros，gazebo
仿真没有很多问题，但是如果要做视觉导航部分的仿真，比较吃力。
 笔者现在电脑的配置为GTX2060，
 AMD Ryzen 5 3600 6-Core Processor × 12，16G的内存。
 目前笔者还没有尝试视觉导航部分的仿真，但这么高的配置，
 应是没有什么问题。 再次建议各位，尽量用一台比较高配的台式电脑，
 显示器数量个人看个人情况。笔者建议显卡至少GTX1060，
 内存大小16G，CPU6核12线程。

 第二节 软件配置
 =============

 1.Ubuntu16.04操作系统
 --------------------

 用UltraISO制作U盘启动盘，步骤如下：
    1）、打开UltraISO软件，打开文件，选择要安装的Ubuntu版本，
    笔者安装的是Ubuntu-16.04.6，偶数版本的都是长期支持版的系
    统镜像，至少到2021年之前是一直被维护的。
    2）、接着我们点击启动->写入磁盘映像，进入下面的界面，在制作
    Ubuntu的U盘启动盘的时候，要选择RAW。笔者之前也尝试过其他
    的写入方式，有时候会成功，有时候会失败。但自从选择了RAW
    之后，装的好几次都是成功了的，所以笔者建议用RAW写入方式。
    3）、之后就是把U盘格式化，然后点击写入即可，
    等待......（长短取决于电脑性能），待完成之后U盘启动盘就
    制作成功了。

安装Ubuntu系统
    插上U盘，开机启动选项中设置U盘启动即可，一般不同的电脑进
    入BIOS的方式不同。之后的安装很简单，百度上有很多教程，
    按照教程安装即可完成安装。笔者直接安装的是Ubuntu系统，
    所以没有什么分区设置。

Ubuntu系统的一点设置
    笔者在装完Ubuntu后发现分辨率很低，看的很难受。查看了一下，
    分辨率只有640x480，然而我的屏幕是1920x1080的。然后通过改
    xrandr和cvt都无效。最后笔者找到解决方案，修改grub默认的
    分辨率，具体过程如下： sudo gedit /etc/default/grub 
    找到: #GRUB_GDXMODE=640x480 改为: 
    GRUB_GDXMODE=1920x1080 然后更新一下grub: 
    sudo update-grub 最后重启电脑即可

    笔者还建议在安装完系统之后，只留下现在所使用的版本的内核，
    删除其余多余的内核，并且禁用内核的更新，否则过段时间，
    系统默认启动更新后的内核。

    安装显卡驱动，Ubuntu默认的显卡驱动是nouveau，你需要安装
    与你显卡相匹配的驱动程序。以NVIDIA驱动为例，首先是查看自己
    显卡，发现是设备ID为1f08，通过 
    https://devicehunt.com/view/type/pci/vendor/10DE/device/1F08 
    搜索发现该驱动是GTX2060，然后我们到
    https://www.nvidia.com/Download/index.aspx?lang=cn 
    下载相应的驱动安装程序。安装的过程你可以参考这篇文档
    https://zhuanlan.zhihu.com/p/31575356


